{% extends 'theme/base.html' %}
{% load humanize static %}

{% block content %}
<div class="bg-gray-50 min-h-screen">

  <!-- =================== BANNER PRINCIPAL =================== -->
  <div class="relative">
    <img src="/media/heros/3 banner.png" class="w-full h-[500px] object-cover">
    <div class="absolute inset-0 bg-black/40 flex flex-col justify-center items-center text-center px-4">
      <h1 class="text-4xl font-extrabold text-white sm:text-5xl">Encuentra el salón perfecto</h1>
      <p class="mt-4 text-lg text-white/80 max-w-2xl">
        Reserva tu salón de fiestas ideal y haz de tu evento un recuerdo inolvidable.
      </p>
      <a href="{% url 'lista_salones' %}" class="mt-8 inline-block rounded-md bg-white text-indigo-600 font-semibold px-6 py-3 hover:bg-gray-100 transition">
        Ver salones
      </a>
    </div>
  </div>

  <!-- =================== NUEVOS SALONES =================== -->
  <section id="nuevos-salones" class="max-w-7xl mx-auto px-4 py-16 sm:px-6 lg:px-8 relative">
    <h2 class="text-3xl font-bold text-gray-900 mb-8">Nuevos salones</h2>

    <div id="recientes" class="flex gap-6 overflow-x-auto scrollbar-hide snap-x snap-mandatory scroll-smooth relative">
  {% for salon in recientes %}
    {% include 'theme/salon_card.html' with salon=salon %}
  {% empty %}
    <p class="text-gray-700 dark:text-gray-300">No hay salones recientes.</p>
  {% endfor %}
</div>


    <!-- Botones scroll -->
    <button class="absolute -left-5 top-1/2 -translate-y-1/2 z-10 p-3 bg-gray-200 rounded-full hover:bg-gray-300 scroll-left" data-target="recientes">
      <svg class="w-6 h-6 text-gray-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m15 19-7-7 7-7"/>
      </svg>
    </button>
    <button class="absolute -right-5 top-1/2 -translate-y-1/2 z-10 p-3 bg-gray-200 rounded-full hover:bg-gray-300 scroll-right" data-target="recientes">
      <svg class="w-6 h-6 text-gray-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m9 5 7 7-7 7"/>
      </svg>
    </button>
  </section>

  <!-- =================== BANNER SECUNDARIO =================== -->
  <div class="relative my-16">
    <img src="/media/heros/4 banner.png" class="w-full h-[400px] object-cover rounded-xl shadow-md">
    <div class="absolute inset-0 bg-black/30 flex flex-col justify-center items-center text-center px-4">
      <h2 class="text-3xl font-bold text-white sm:text-4xl">Haz de tu evento algo único</h2>
      <p class="mt-3 text-white/80 max-w-xl">Explora nuestros salones en tendencia y más cercanos.</p>
    </div>
  </div>

  <!-- =================== SALONES EN TENDENCIA =================== -->
  <section class="max-w-7xl mx-auto px-4 py-16 sm:px-6 lg:px-8 relative">
    <h2 class="text-3xl font-bold text-gray-900 mb-8">Tendencia</h2>

    <div id="tendencia" class="flex gap-6 overflow-x-auto scrollbar-hide snap-x snap-mandatory scroll-smooth relative">

      {% for salon in tendencia %}
        {% include 'theme/salon_card.html' with salon=salon %}
      {% empty %}
        <p class="text-gray-700 dark:text-gray-300">No hay salones en tendencia.</p>
      {% endfor %}
    </div>

    <!-- Botones scroll -->
    <button class="absolute -left-5 top-1/2 -translate-y-1/2 z-10 p-3 bg-gray-200 rounded-full hover:bg-gray-300 scroll-left" data-target="tendencia">
      <svg class="w-6 h-6 text-gray-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m15 19-7-7 7-7"/>
      </svg>
    </button>
    <button class="absolute -right-5 top-1/2 -translate-y-1/2 z-10 p-3 bg-gray-200 rounded-full hover:bg-gray-300 scroll-right" data-target="tendencia">
      <svg class="w-6 h-6 text-gray-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m9 5 7 7-7 7"/>
      </svg>
    </button>
  </section>

  <!-- =================== SALONES MÁS CERCANOS =================== -->
  <section class="max-w-7xl mx-auto px-4 py-16 sm:px-6 lg:px-8 relative">
    <h2 class="text-3xl font-bold text-gray-900 mb-8">Más cercanos</h2>

    <div id="mas-cercanos" class="flex gap-6 overflow-x-auto scrollbar-hide snap-x snap-mandatory scroll-smooth relative">
      {% for salon in mas_cercanos %}
        {% include 'theme/salon_card.html' with salon=salon %}
      {% empty %}
        <p class="text-gray-700 dark:text-gray-300">No hay salones cercanos.</p>
      {% endfor %}
    </div>

    <!-- Botones scroll -->
    <button class="absolute -left-5 top-1/2 -translate-y-1/2 z-10 p-3 bg-gray-200 rounded-full hover:bg-gray-300 scroll-left" data-target="mas-cercanos">
      <svg class="w-6 h-6 text-gray-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m15 19-7-7 7-7"/>
      </svg>
    </button>
    <button class="absolute -right-5 top-1/2 -translate-y-1/2 z-10 p-3 bg-gray-200 rounded-full hover:bg-gray-300 scroll-right" data-target="mas-cercanos">
      <svg class="w-6 h-6 text-gray-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m9 5 7 7-7 7"/>
      </svg>
    </button>
  </section>

</div>

<!-- =================== SCRIPT PARA SCROLL =================== -->
<script>
/* ------- Smooth card-by-card scrolling for gallery buttons ------- */
/* Replace your current script with this one. It:
   - Finds the first real card element (ignores text nodes)
   - Computes card width + actual gap (works for Tailwind gap-*)
   - Animates to the target scroll position with easeOutCubic
   - Cancels previous animation when a new click happens
*/

(function () {
  // Easing function (easeOutCubic)
  function easeOutCubic(t) { return 1 - Math.pow(1 - t, 3); }

  // Utility to get numeric gap between flex children (supports modern 'gap' or fallback to guessed value)
  function getGapPx(container) {
    try {
      const style = getComputedStyle(container);
      // modern browsers support style.gap; fallback to columnGap/rowGap
      const gapValue = style.gap || style.columnGap || style.rowGap || '';
      if (gapValue && gapValue.endsWith('px')) return parseFloat(gapValue);
      // If gap is in rem/em/%, try computed pixel value (rare). We'll fallback next:
    } catch (e) {}
    // fallback: attempt to compute from difference of first two children positions
    const children = Array.from(container.children).filter(c => c.offsetWidth);
    if (children.length >= 2) {
      const r0 = children[0].getBoundingClientRect();
      const r1 = children[1].getBoundingClientRect();
      return Math.max(0, Math.round((r1.left - (r0.left + r0.width))));
    }
    // final fallback: typical Tailwind 'gap-6' -> 1.5rem -> usually 24px
    return 24;
  }

  // Animate scrollLeft to target position with duration (ms)
  function animateTo(element, target, duration = 500) {
    // cancel previous animation if present
    if (element._scrollAnim) {
      cancelAnimationFrame(element._scrollAnim.raf);
      element._scrollAnim = null;
    }

    const start = element.scrollLeft;
    const max = element.scrollWidth - element.clientWidth;
    target = Math.max(0, Math.min(target, max));
    const distance = target - start;
    if (distance === 0) return;

    const startTime = performance.now();
    const anim = { raf: null };

    function step(now) {
      const elapsed = now - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const eased = easeOutCubic(progress);
      element.scrollLeft = start + distance * eased;

      if (progress < 1) {
        anim.raf = requestAnimationFrame(step);
      } else {
        element._scrollAnim = null;
      }
    }

    element._scrollAnim = anim;
    anim.raf = requestAnimationFrame(step);
  }

  // Safe function to get first visible card element
  function getFirstCard(container) {
    return Array.from(container.children).find(el => el.nodeType === 1 && el.offsetWidth);
  }

  // Main wiring: attach listeners to left/right buttons
  document.querySelectorAll('.scroll-left, .scroll-right').forEach(btn => {
    btn.addEventListener('click', () => {
      const container = document.getElementById(btn.dataset.target);
      if (!container) return;

      const firstCard = getFirstCard(container);
      if (!firstCard) return;

      const gap = getGapPx(container);
      // Use bounding rect to include transforms and subpixel sizes
      const cardWidth = Math.round(firstCard.getBoundingClientRect().width);

      // How many cards to move per click? 1 by default. Use container.clientWidth/cardWidth for "page" movement.
      const cardsToMove = 1;
      const direction = btn.classList.contains('scroll-right') ? 1 : -1;
      const delta = (cardWidth + gap) * cardsToMove * direction;

      const current = container.scrollLeft;
      const target = current + delta;

      // duration can be adjusted based on cardWidth for consistent speed
      const baseDuration = 450; // ms for one card
      const duration = Math.min(800, Math.max(300, Math.abs(delta) / (cardWidth + gap) * baseDuration));

      animateTo(container, target, duration);
    });
  });

  // Optional: allow keyboard arrows when a gallery is focused (nice UX)
  document.querySelectorAll('#recientes, #tendencia, #mas-cercanos').forEach(container => {
    container.setAttribute('tabindex', '0'); // make focusable
    container.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight') {
        e.preventDefault();
        const fakeBtn = { dataset: { target: container.id }, classList: { contains: () => true } };
        // reuse logic by dispatching programmatically
        const firstCard = getFirstCard(container);
        if (!firstCard) return;
        const gap = getGapPx(container);
        const cardWidth = Math.round(firstCard.getBoundingClientRect().width);
        const delta = cardWidth + gap;
        animateTo(container, container.scrollLeft + delta, 350);
      } else if (e.key === 'ArrowLeft') {
        e.preventDefault();
        const firstCard = getFirstCard(container);
        if (!firstCard) return;
        const gap = getGapPx(container);
        const cardWidth = Math.round(firstCard.getBoundingClientRect().width);
        const delta = cardWidth + gap;
        animateTo(container, container.scrollLeft - delta, 350);
      }
    });
  });
})();
</script>




<style>
  .scrollbar-hide::-webkit-scrollbar { display: none; }
  .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
</style>

{% endblock %}
